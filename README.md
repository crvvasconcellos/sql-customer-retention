# Customer Retention & Revenue Analytics (SQL / SQLite)

## Overview
This project analyzes customer behavior and revenue performance using SQL, focusing on customer churn,
retention between periods (2023 → 2024), repeat purchase patterns, customer lifetime value,
and revenue concentration (Pareto analysis).

It applies common metrics used by product, marketing, and revenue teams to
evaluate customer health, engagement, and revenue distribution.

The analysis progresses from customer retention and purchase behavior
to revenue performance and concentration analysis.

---

## Business Questions Answered

### Customer Retention & Behavior
- Which customers are considered churned after 2023?
- Which customers were retained from 2023 to 2024?
- What is the customer retention rate for 2024?
- How quickly do customers place a second order?
- Which products perform best by country?
- How many customers remain active in the months following their first purchase?
- What percentage of customers progress from first to second and third purchases?
- What are the conversion rates between purchase stages?
- What is the average time between consecutive purchases?

### Revenue & Customer Value
- What are the core revenue KPIs (Total Revenue, Orders, AOV, ARPU)?
- What is the lifetime revenue generated by each customer?
- What share of total revenue is generated by the top 20% of customers?
- What percentage of customers is required to reach 80% of total revenue?

---

## Queries

### Retention & Behavioral Analysis
- Churned customers after 2023: `queries/01_churn_customers.sql`
- Retained customers (2023 → 2024): `queries/02_retained_customers_2023_2024.sql`
- Retention rate for 2024: `queries/03_retention_rate_2024.sql`
- Fast repeat purchase (second order within 30 days): `queries/04_repeat_purchase_within_30_days.sql`
- Top product by country (by quantity): `queries/05_top_products_by_country.sql`
- Monthly cohort retention (cohort month + month index + retention rate): `queries/06_monthly_cohort_retention.sql`
- Repeat purchase funnel & time between orders: `queries/07_repeat_purchase_funnel.sql`

### Revenue & Concentration Analysis
- Revenue KPIs (Total Revenue, Orders, AOV, ARPU): `queries/08_revenue_kpis.sql`
- Customer lifetime revenue (LTV): `queries/09_customer_lifetime_revenue.sql`
- Pareto analysis – 80% revenue list (customer ranking & flag): `queries/10_pareto_80_list.sql`
- Pareto summary – Top 20% share & % customers for 80%: `queries/11_pareto_summary.sql`

---

## Database Schema
The analysis uses a simplified transactional model:

- **customers**: one row per customer  
- **orders**: one row per order (1:N relationship with customers)  
- **order_items**: line items per order (1:N relationship with orders)

The full schema definition is available in `schema/schema.sql`.

---

## Metrics Definitions

### Retention & Behavior
- **Churned customer (after 2023)**: customer with at least one historical order
  and no orders after `2023-12-31`.
- **Retained customer (2023 → 2024)**: customer with at least one order in 2023
  and at least one order in 2024.
- **Retention rate 2024**: retained customers divided by customers who purchased
  in 2023.
- **Fast repeat purchase**: second order placed within 30 days of the first order.
- **Cohort month**: month of customer’s first order (truncated to month).
- **Active customer (monthly)**: customer with at least one order in a month.
- **Monthly retention rate**: active_customers / cohort_size for each cohort_month and month_index.
- **Customers 1+**: total number of customers with at least one order.
- **Customers 2+**: customers with a second recorded order.
- **Customers 3+**: customers with a third recorded order.
- **Conversion to 2nd order (%)**: customers_2plus / customers_1plus.
- **Conversion to 3rd order (%)**: customers_3plus / customers_2plus.
- **Average days 1→2**: average number of days between first and second order.
- **Average days 2→3**: average number of days between second and third order.

### Revenue & Value
- **Total revenue**: sum of `quantity * item_amount` across all order items.
- **Total orders**: distinct count of `order_id`.
- **Total customers**: distinct count of `customer_id`.
- **Average Order Value (AOV)**: total_revenue / total_orders.
- **ARPU (Average Revenue Per User)**: total_revenue / total_customers.
- **Customer lifetime revenue (LTV)**: total revenue generated by a customer across all orders.
- **Top 20% revenue share**: revenue generated by the top 20% of customers
  (ranked by revenue) divided by total revenue.
- **Customers needed for 80% revenue**: smallest number (and percentage) of
  top-revenue customers whose cumulative revenue reaches at least 80% of total revenue.

---

## Skills Demonstrated
- Analytical SQL for behavioral and revenue analysis (EXISTS / NOT EXISTS, CTEs)
- Advanced window functions (ROW_NUMBER, cumulative sums, ranking)
- Time-based customer metrics (churn, retention, repeat purchase)
- Revenue concentration (Pareto analysis) using running totals
- Business-oriented metric definition and validation
- Structured CTE-based query design for clarity and explainability

---

## Notes
- Data is modeled for analytical demonstration purposes.
- The focus is on correctness, clarity, and business reasoning rather than data volume.
- Queries are organized to reflect a real-world analytical workflow:
  retention → behavior → revenue → concentration.
